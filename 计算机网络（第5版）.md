
# 应用层
```
应用层是体系结构中的最高层，应用层直接为用户的应用进程提供服务。
``` 
应用层协议：万维网应用的HTTP协议，支持电子邮件的SMTP协议，支持文件传送的FTP
2：运输层
运输层的任务就是负责想2个主机中进程通信提供服务。
因为主机可同时运行多个进程，因此运输层有复用和分用的功能。复用就是应用层可同时使用下面运输层的服务，分用就是运输层把收到的信息分别交付给上面应用相应的进程
1）传输控制协议TCP（Transmiision Control Protocol）--面向连接的，数据传输的单位是报文段，能够提供可靠的交付。
2）用户数据报协议UDP（User Datagram Protocol）--无连接的，数据传输的单位是 用户数据报，不保证可靠的交付，只能提供“尽最大努力交付”
3：网络层
网络层负责为分组交换网上的不同主机提供通信服务。网络层负责吧运输层产生的数据封装成分组或者包进行传送。网络层使用IP协议也叫做IP数据报。
网络层还会选择合适的路由，使源主机运输层锁传下来的分组，能够通过网络中的路由器找到目的主机。
4：数据链路层
把网络层IP数据报封装成帧，在相邻的节点间的链路上“透明”地传送帧中的数据。知道哪一帧开始哪一帧结束。
5：物理层
物理层传输单位是比特，物理层的任务是传输比特流。


1：物理层
数据通信系统的模型：源系统，传输系统，目的系统
源系统：源点：源点设备产生要传输的数据，发送器：通常源点生成的数字比特流要通过发送器编码后才能够在传输系统中进行传输。
目的系统：接收器：接受传输系统传送过来的信号，并把他转换为能够被目的设备处理的信息，重点：重点设备从接收器获取传送来的数字比特流。
信道：
1）单向通信：单工通信，只能有一个方向的通信，有线电视广播，电视广播
2）双方交替通信：半双工通信，双方都能发送消息，但是不能同时发送
3）双向同时通信：双方可以同时发送和接受消息

2：数据链路层
信道主要有2种模式：
1）点对点信道，这种信道使用一对一的点对点通信方式
2）广播信道：这种信道使用一堆多的广播通信方式，因此过程IJCAI复杂，广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。
数据链路：当需要在一条线路上传送数据是，出了必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输。把这些协议的硬件和软件加到链路上，就构成了数据链路。
点对点信道的数据链路层的协议数据单元---帧
数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据取出并上交给网络层。网络层的数据单元就是IP数据报（数据报，分组或包）
数据链路层的三个基本问题：
1：封装成帧：在数据添加首部和尾部，就封装成帧。因此帧长等于数据部分的长度加上帧的首部和尾部。首部和尾部的主要作用就是进行帧定界。
首部和尾部还包括许多必要的控制信息。数据链路协议都要对帧首部和尾部的格式有明确的规定。为了提高效率数据要尽量大于首部和尾部。
每一种数据链路协议都规定了帧的数据部分长度上限---最大传送单元MTU（数据部分）
2：透明传输：如果只传送文本，就不用对首部和尾部进行任何操作，这种传输就是透明传输。但是如果是图像等那么可能就存在尾部和首部的误差。
可以在数据中增加转义字符，这种做法就做字节填充或字符填充。在发送网络层之前要删除。
3：差错检测：可能0变1,1变0.这就叫做比特差错。
目前常用的检测是：循环冗余检验CRC
点对点协议PPP的组成部分
1）一个将IP数据报封装到串行链路的方法，可以异步也可以同步，IP数据报在PPP帧中就是其信息部分。信息部分受MTU的限制。
2）一个用来建立，配置和测试数据链路链接的链路控制协议LCP。
3）一套网络控制协议NCP
2.1：PPP协议的的帧格式：首部尾部分别为四个字段和两个字段
首部的第一个字段和尾部最后一个字段是标志字段，代表开始和结束：0x7E。也就是定界符。
首部的第二个字段和第三个字段没预留字段
首部的第四个字段是数据类型字段：0x0021：代表IP数据报，0xC021:PPP链路层协议LCP。0x8021网络层的控制数据。
尾部的第一个字段是FCS,CRC校验字段
字节填充：如果数据中存在0x7E则需要转义，转义的字符就是填充字段：0x7D
零比特填充：在比特流中只要发现连续的5个1就在后面加一个0，在接收端再把0去掉
数据链路层如何接入局域网：
计算机与外界局域网的连接通过通信适配器。适配器本来是在主机箱内插入一个网络接口板，这个接口板又称为网络接口卡或简称为网卡。网卡上面装有处理器（RAM)和存储器（ROM).
适配器和局域网之间的通信通过电缆或双绞线以串行的方式进行的，适配器和计算机之间的通信则通过计算机主板上的I/O总线以并行的方式进行的。
因为网络上的数据率和计算机总线的数据率并不一致，所以适配器装有数据缓存装置，还要装有管理适配器的驱动程序，告诉适配器应当从存储器的什么位置上多长的数据块发送到局域网。
当适配器接收到正确的帧时，就是用中断来通知计算机并交付给协议栈中的网络层。
计算机中的硬件地址在ROM中，计算机的软件地址-IP地址，在计算机的存储器中。
2.2：CSMA/CD协议：
	1）载波监听：在发送数据前监听是否存在有其他数据在发送，则等待
	2）碰撞检测：变发送变监听，如果发生碰撞则不在发送。
2.3：以太网的MAC层，以太网的数据传送单位是帧
	固定的适配器（网卡）都会有一个MAC地址，物理地址，硬件地址
	MAC帧格式：以太网V2格式（使用较多）和IEEE的802.3标准（使用较少）。
	以太网V2格式：5个字段
	前2个字段：12个字节的目的地址和源地址；
	第三个字段：2个字节的类型字段；用来标志上一层使用的什么协议
	第四个字段：数据字段：长度46到1500字节之间。
	第5个字段：4个字节帧校验序列FCS(使用CRC检测)
	2.3.1：扩展以太网：以太网的主机之间的距离不能太远，所以需要扩展
	在物理层扩展以太网：最开始的时候增加转发器，但是转发器是有个数限制，现在都是在主机和集线器之间使用光纤和一堆光纤调制解调器（光信号转电信号）。
	在数据链路层扩展以太网：使用网桥。它根据MAC帧的目的地址对收到的帧进行转发和过滤。检查此帧的目的地址，确定转发到哪个接口，或者丢弃（过滤）
	网桥的内部结构：
	2个以太网可以通过网桥连接，每个以太网则称为网段，网桥通过转发表转发帧，转发表也可以叫转发数据库或者路由目录。网桥在转发帧时不改变帧的源地址。
	目前使用最多的是透明网桥：以太网上的站点不知道锁发送的帧要经过哪几个网桥，以太网上的站点都看不见以太网上的网桥。透明网桥是一个即插即用设备。
	通过转发表进行转发，每个机器发送到网桥都会记录在转发表。
	2.3.2：源路由网桥：透明网桥安装方便，但是网络资源利用不充分，另一种由帧的源站负责路由选择的网桥-源路由网桥：发送帧时把详细的路由信息放在帧的首部中。

3：网络层
网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务。
	网际协议IP是TCP/IP体系中两个最主要的协议之一，与之配套使用的协议还有四个协议：
	地址解析协议ARP(Address Resolution Protocol)
	逆地址解析协议RARP（Reverse Address Resolution Protocol）
	网际控制报文协议ICMP（Internet Control Message Protocol）
	网际组管理协议IGMP（Internet Group Management Protocol）
	1）分类的IP地址：A,B,C类地址都是单拨地址
		IP地址=网络号 + 主机号
		A,B,C类地址占用字节分别为1,2,3字节，前1,2,3位为类别位，分别为0,10,110。那相反的主机号分别占用3,2,1字节
		D类地址为多播，前4位1110
		E类地址为保留，前4位1111
		IP地址是32位二进制代码，为了方便记忆通常使用点分十进制记法。
		IP地址与硬件地址：
		ip数据报经过路由器但是其首部中的源地址和目的地址始终分别日子IP1和IP2.
		地址解析协议ARP和逆地址解析协议RARP（现在已经被DHCP协议取代）
		ARP根据IP找到物理地址：在主机中设有有一个ARP高速缓存。里面有本局域网上的各主机和路由的IP地址到硬件地址的映射表。
		运作原理：当主机A向某个主机发送消息，先查找ARP缓存是否有IP地址对应的MAC地址，如果有的话封装成帧，然后通过局域网发往此硬件的地址。
		如果没有的话，就自动运行ARP，然后找硬件地址步骤如下：
		1）ARP进程想局域网中法波发送一个ARP请求分组，主要内容大概意思是：我的IP地址是209.0.0.5，硬件地址是00-00-C0-15-0A-D0-18,我想知道IP地址为209.0.0.6主机的硬件地址？
		2）在局域网中所有运行ARP进程收到此ARP请求分组。
		3）主机B在ARP请求分组见到自己的IP地址则发送回复消息，单拨发给请求的主机，这样A就能知道接收方的地址了
		4）在任何主机收到ARP请求时，自动会存储请求主机的MAC地址。
		IP数据报格式 总24字节
		版本 4  | 首部长度 4| 区分服务 8 | 总长度 16
					标识 16              | 标志 4    | 片偏移 12  |
		生存时间       | 协议 			 | 首部校验和 
		源地址 32
		目的地址 32
		可选字段（长度可变） | 填充
		数据部分
		ip层转发分组的流程
		
		
	2）子网划分
	3）构成超网
	


	


























